# í•­í•´í”ŒëŸ¬ìŠ¤ ë°±ì—”ë“œ 4ê¸° ì„œë²„ êµ¬ì¶• ì‹œë‚˜ë¦¬ì˜¤ "ì½˜ì„œíŠ¸ ì˜ˆì•½"

- `ì½˜ì„œíŠ¸ ì˜ˆì•½ ì„œë¹„ìŠ¤`ë¥¼ êµ¬í˜„í•´ ë´…ë‹ˆë‹¤.
- ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³ , ì˜ˆì•½ ì„œë¹„ìŠ¤ëŠ” ì‘ì—…ê°€ëŠ¥í•œ ìœ ì €ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.
- ì¢Œì„ ì˜ˆì•½ ìš”ì²­ì‹œì—, ê²°ì œê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šë”ë¼ë„ ì¼ì • ì‹œê°„ë™ì•ˆ ë‹¤ë¥¸ ìœ ì €ê°€ í•´ë‹¹ ì¢Œì„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ í•©ë‹ˆë‹¤.

## Requirements

- ì•„ë˜ 5ê°€ì§€ API ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
    - ìœ ì € í† í° ë°œê¸‰ API
    - ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API
    - ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API
    - ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API
    - ê²°ì œ API
- ê° ê¸°ëŠ¥ ë° ì œì•½ì‚¬í•­ì— ëŒ€í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë“œì‹œ í•˜ë‚˜ ì´ìƒ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë‹¤ìˆ˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ë”ë¼ë„ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ì—†ë„ë¡ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë™ì‹œì„± ì´ìŠˆë¥¼ ê³ ë ¤í•˜ì—¬ êµ¬í˜„í•©ë‹ˆë‹¤.
- ëŒ€ê¸°ì—´ ê°œë…ì„ ê³ ë ¤í•´ êµ¬í˜„í•©ë‹ˆë‹¤.

## API ê°œìš”

1ï¸âƒ£`ì£¼ìš”` ìœ ì € ëŒ€ê¸°ì—´ í† í° ê¸°ëŠ¥

- ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  í† í°ì„ ë°œê¸‰ë°›ëŠ” APIë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- í† í°ì€ ìœ ì €ì˜ UUID ì™€ í•´ë‹¹ ìœ ì €ì˜ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì •ë³´ ( ëŒ€ê¸° ìˆœì„œ or ì”ì—¬ ì‹œê°„ ë“± ) ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- ì´í›„ ëª¨ë“  API ëŠ” ìœ„ í† í°ì„ ì´ìš©í•´ ëŒ€ê¸°ì—´ ê²€ì¦ì„ í†µê³¼í•´ì•¼ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

> ê¸°ë³¸ì ìœ¼ë¡œ í´ë§ìœ¼ë¡œ ë³¸ì¸ì˜ ëŒ€ê¸°ì—´ì„ í™•ì¸í•œë‹¤ê³  ê°€ì •í•˜ë©°, ë‹¤ë¥¸ ë°©ì•ˆ ë˜í•œ ê³ ë ¤í•´ë³´ê³  êµ¬í˜„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2ï¸âƒ£`ê¸°ë³¸` ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API

- ì˜ˆì•½ê°€ëŠ¥í•œ ë‚ ì§œì™€ í•´ë‹¹ ë‚ ì§œì˜ ì¢Œì„ì„ ì¡°íšŒí•˜ëŠ” API ë¥¼ ê°ê° ì‘ì„±í•©ë‹ˆë‹¤.
- ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‚ ì§œ ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ ì˜ˆì•½ê°€ëŠ¥í•œ ì¢Œì„ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì¢Œì„ ì •ë³´ëŠ” 1 ~ 50 ê¹Œì§€ì˜ ì¢Œì„ë²ˆí˜¸ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.

3ï¸âƒ£`ì£¼ìš”` ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API

- ë‚ ì§œì™€ ì¢Œì„ ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ ì¢Œì„ì„ ì˜ˆì•½ ì²˜ë¦¬í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ì¢Œì„ ì˜ˆì•½ê³¼ ë™ì‹œì— í•´ë‹¹ ì¢Œì„ì€ ê·¸ ìœ ì €ì—ê²Œ ì•½ 5ë¶„ê°„ ì„ì‹œ ë°°ì •ë©ë‹ˆë‹¤. ( ì‹œê°„ì€ ì •ì±…ì— ë”°ë¼ ììœ¨ì ìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤. )
- ë°°ì • ì‹œê°„ ë‚´ì— ê²°ì œê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¢Œì„ì— ëŒ€í•œ ì„ì‹œ ë°°ì •ì€ í•´ì œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- ë°°ì • ì‹œê°„ ë‚´ì—ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” ì˜ˆì•½í•  ìˆ˜ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.

4ï¸âƒ£`ê¸°ë³¸`  ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API

- ê²°ì œì— ì‚¬ìš©ë  ê¸ˆì•¡ì„ API ë¥¼ í†µí•´ ì¶©ì „í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì‹ë³„ì ë° ì¶©ì „í•  ê¸ˆì•¡ì„ ë°›ì•„ ì”ì•¡ì„ ì¶©ì „í•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì‹ë³„ìë¥¼ í†µí•´ í•´ë‹¹ ì‚¬ìš©ìì˜ ì”ì•¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

5ï¸âƒ£`ì£¼ìš”` ê²°ì œ API

- ê²°ì œ ì²˜ë¦¬í•˜ê³  ê²°ì œ ë‚´ì—­ì„ ìƒì„±í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ê²°ì œê°€ ì™„ë£Œë˜ë©´ í•´ë‹¹ ì¢Œì„ì˜ ì†Œìœ ê¶Œì„ ìœ ì €ì—ê²Œ ë°°ì •í•˜ê³  ëŒ€ê¸°ì—´ í† í°ì„ ë§Œë£Œì‹œí‚µë‹ˆë‹¤.

<aside>
ğŸ’¡ KEY POINT

</aside>

- ìœ ì €ê°„ ëŒ€ê¸°ì—´ì„ ìš”ì²­ ìˆœì„œëŒ€ë¡œ ì •í™•í•˜ê²Œ ì œê³µí•  ë°©ë²•ì„ ê³ ë¯¼í•´ ë´…ë‹ˆë‹¤.
- ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì˜ˆì•½ ìš”ì²­ì„ í–ˆì„ ë•Œ, ì¢Œì„ì´ ì¤‘ë³µìœ¼ë¡œ ë°°ì • ê°€ëŠ¥í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.

## Milestone

- 3ì£¼ì°¨ (ì„¤ê³„ & Mock API)
    - SPRINT 1 [[ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/1)]
    - SPRINT 2 [[ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/2)]
- 4ì£¼ì°¨ (ê¸°ëŠ¥ êµ¬í˜„)
    - SPRINT 3 [[ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/3)]
    - SPRINT 4 [ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/4)
- 5ì£¼ì°¨ (ê¸°ëŠ¥ ê³ ë„í™”)
    - SPRINT 5 [[ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/5)]
    - SPRINT 6 [[ìƒì„¸ë³´ê¸°](https://github.com/JeHwanYoo/hpb-concert/milestone/6)]

ê°„íŠ¸ì°¨íŠ¸ (ì‘ì„± ì˜ˆì •): https://github.com/users/JeHwanYoo/projects/1/views/2

## Sequence Diagram

![sequence diagram](./assets/sequence.jpg)

## API Specifications

- ìœ ì € í† í°: ìš”êµ¬ì‚¬í•­ì— ë”°ë¼, ìœ ì € í† í°ì€ DB ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„ì˜ë¡œ ìƒì„± (ë¡œê·¸ì¸ âŒ)
- ëŒ€ê¸°ì—´ í† í°: ëŒ€ê¸°ì—´ì„ ì´ìš©í•œ API í† í°

### ëŒ€ê¸°ì—´ ìš”ì²­

- Endpoint: POST /enqueues
- Request
    - Authorization: ìœ ì € í† í°
- Response
    - 200: OK. ëŒ€ê¸°ì—´ í† í° ë°˜í™˜
    - 400: Bad Request
    - 401: Unauthorized

- ğŸš§ ê³ ë ¤ì‚¬í•­, `SSE`, `ì†Œì¼“` ë“±ì„ ì´ìš©í•œ ì‹¤ì‹œê°„ í†µì‹ 

## ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API

- Endpoint: GET /concerts/:concert_id/seats
- Response
    - 200: Ok. ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„

## ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API

- Endpoint: POST /concerts/:concert_id/seats/:seat_no/reservations
- Request
    - Authorization: ëŒ€ê¸°ì—´ í† í°
- Response
    - 200: OK. ì˜ˆì•½ ì™„ë£Œ
    - 400: Bad Request
    - 401: Unauthorized
    - 403: Forbidden

## ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API

- Endpoint: [GET | PATCH] /charges
- Request
    - Authorization: ìœ ì € í† í°
- Response
    - 200: OK. ì¶©ì „ / ì¡°íšŒ ì™„ë£Œ
    - 400: Bad Request
    - 401: Unauthorized
    - 403: Forbidden

## ê²°ì œ API

- Endpoint: POST /concerts/:concert_id/seats/:seat_no/payments
- Request
    - Authorization: ëŒ€ê¸°ì—´ í† í°
- Response
    - 200: OK. ê²°ì œ ì™„ë£Œ
    - 400: Bad Request
    - 401: Unauthorized
    - 403: Forbidden

## ERD

![hpb tables](./assets/hpb_tables.jpg)

## Mock API

<del>MockAPI ë¥¼ NestJS ë¡œ êµ¬í˜„</del>

- <del>mocks/mocks.module.ts</del>
- <del>http/mocks.http</del>

> Todo: Swagger Mock API ë¡œ ì œê³µ ì˜ˆì •

## ê¸°ìˆ  ìŠ¤íƒ

- Main Framework: NestJS (Fastify + SWC)
- Test Framework: Vitest & testcontainer (integrated, e2e...)
- DBMS: Postgres + Prisma
- Queue Service: Redis + @nestjs/bull

## OpenAPI

![](./assets/SwaggerUI.jpeg)

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

- `src/apis/*`: API Controller, UseCase Layers
- `src/domains/*`: Business(Service) Layers
- `src/infra/*`: Infrastructure Layers
    - `prisma`: Prisma Connection
    - `redis`: Redis Connection
    - `repositories/*`: The implementations of repository interfaces
- `src/shared/*`: ê³µí†µíŒŒì¼
    - `src/shared/transaction`: íŠ¸ëœì­ì…˜ ê³µí†µ ì¸í„°í˜ì´ìŠ¤ ëª¨ë“ˆ

- `**/*.spec.ts`: ìœ ë‹› í…ŒìŠ¤íŠ¸ & í†µí•© í…ŒìŠ¤íŠ¸
    - ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„ì€ ì‹¤ì œ DBì™€ ë¶™ì—¬ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ì˜ë¯¸ ìˆë‹¤ íŒë‹¨í•˜ì—¬, í†µí•© í…ŒìŠ¤íŠ¸ë¡œ êµ¬í˜„í•˜ì˜€ìŒ.
- `**/*.e2e-spec.ts`: E2E í…ŒìŠ¤íŠ¸

## ì„œë¹„ìŠ¤ ì‹¤í–‰ (ë¡œì»¬)

```yaml
docker compose up --build -d
```
